# Теоретические основы использования Markdown {#theory}

## Язык разметки Markdown {#markdown-hist}

Язык разметки Markdown создал Джон Грубер совместно с Аароном Шварцем в 2004 году. Ниже преставлена полная цитата, отражающая цель создания языка:

> John Gruber created the Markdown language in 2004 in collaboration with Aaron Swartz on the syntax, with the goal of enabling people "to write using an easy-to-read, easy-to-write plain text format, and optionally convert it to structurally valid XHTML (or HTML)".

Официальный логотип языка Markdown представлен на рисунке ![](figures/Markdown-mark.png) .

В настоящее время язык широко используется следующими сайтами и организациями:

* [GitHub.com](http://github.com) - GitHub Flavored Markdown (GFM) - сайт с публичными и частными Git-репозиториями;
* [BitBucket.org](https://bitbucket.org) - сайт с публичными и частными Git- и Mercurial- репозиториями;
* [GitLab.com](https://about.gitlab.com/) - система упраления проектами с поддержкой Git-репозиториев;
* [Atlassian JIRA](https://www.atlassian.com/software/jira) - система управления задачами и проектами;
* [WordPress.com](https://wordpress.com/) - веб-платформа для создания сайтов и блогов;
* [StackOverflow.com](https://stackoverflow.com/) - сеть сайтов вопросов и ответов по множеству тематик (например, AskUbuntu.com для пользователей Ubuntu).

Язык Markdown обладает следующими преимуществами:

* текстовый удобный для редактирования и чтения формат;
* легко просматривать отличия между версиями и искать текст файловым менеджером и даже командой `grep`;
* возможна совместная работа в системе контроля версий (Git, Mercurial и пр.).

Для редактирования и просмотра Markdown документов может использоваться текстовый редактор с поддержкой Markdown:

* ReText (Windows, Linux - [https://github.com/retext-project/retext](https://github.com/retext-project/retext));
* GhostWriter (Windows, Linux - [https://wereturtle.github.io/ghostwriter](https://wereturtle.github.io/ghostwriter));
* Typora (Windows, Linux, macOS - [https://typora.io/](https://typora.io/));
* Remarkable (Windows, Linux - [http://remarkableapp.github.io/](http://remarkableapp.github.io/));
* Geany (Windows, Linux, macOS - [https://geany.org/](https://geany.org/));
* Atom text editor (Windows, Linux,  macOS - [https://atom.io/](https://atom.io/));
* Dilinger (online - [https://dillinger.io](https://dillinger.io)).

Практически все редакторы имеют одинаковые стандартные возможности: форматирование, отображение Markdown и экспорт в HTML, PDF, ODT (OpenDocument) и др.

Настоящий документ написан с использованием обобщенного синтаксиса Markdown, поэтому изучение синтаксиса языка можно выполнять путем просмотра и/или редактирования отдельных элементов текста документа.

## Синтаксис Markdown {#markdown-syntax}

Далее рассматривается обобщенный Markdown синтаксис, включающий в себя:

* исходный **Makdown** синтаксис (см. [http://daringfireball.net/projects/markdown](http://daringfireball.net/projects/markdown));
* расширение **RMarkdown** (см. [RMarkdown Cheat Sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/master/rmarkdown-2.0.pdf) и [RMarkdown Reference](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf));
* **bookdown** для написания книг (см. [книгу Yihui Xie "bookdown: Authoring Books and Technical Documents with R Markdown"](https://bookdown.org/yihui/bookdown/)).

Исходный синтаксис **Markdown** обеспечивает форматирование документа.

**RMarkdown** позволяет выполнять расчеты на языке программирования R ![](figures/Rlogo.png) (см. [https://www.r-project.org/](https://www.r-project.org/)) и оформлять полученные результаты в одном документе.

**Bookdown** -- это расширение RMarkdown для создания книг, его создал Yihui Xie в 2016 году. Официальная книга постоянно обновляется и расположена по адресу [https://bookdown.org/yihui/bookdown/](https://bookdown.org/yihui/bookdown/).

Назначение bookdown: автоматизированное получение из одного Rmd-документа файлов любых форматов (PDF, epub, HTML, docx, Mobi).

Дополнительная функциональность bookdown:

* Автоматическое создание оглавления.
* Автоматическая одноуровневая или двухуровневая нумерация рисунков, таблиц, формул, теорем, доказательств и т.п.
* Построение списка литературы в тексте учетом выбранного стиля оформления (например, в порядке упоминания источников).
* Использование вычислительных возможностей языка R - возможность расчета графиков и вставки их в текст, включение файлов в текст.
* Возможность выполнения программ скриптов в операционной системе и их включения в текст.
* Автоматическое создание алфавитного указателя в LaTeX и PDF.

**Программное обеспечение и особенности**. Для работы с RMarkdown требуется установить среду разработки RStudio ![](figures/rstudio.png) и TeXLive для экспорта в LaTeX и PDF. Эти вопросы рассмотрены подробнее в разделе \@ref(software). При этом процесс получения документов имеет вид:

![](figures/Rmd.png)

Выходными форматами являются PDF, ODT, RTF, HTML, docx. Подробности этого процесса описаны в книгах Yihui Xie.

Перейдем к рассмотрению обобщенного синтаксиса Markdown.

### Заголовки {#markdown-syntax-head}

Заголовки в Markdown обозначаются с помощью символа "решетка" (#). Заголовок 1-го уровня имеет один символ #, заголовок 2-го уровня - "##" и т.п.

Заголовки могут иметь идентификатор, он указывается в фигурных скобках, см. например заголовок этого пункта. Все идентификаторы не должны содержать подчеркиваний ("_"), но могут содержать знаки минус ("-").

Ссылка на нумерованный раздел с известным идентификатором будет иметь вид: см. раздел \@ref(markdown-syntax-head).

Так же ссылка может быть задана с произвольным текстом: см. [введение](#intro). Этот вариант предпочтителен для экспорта в DOCX.

### Эффекты шрифта {#markdown-syntax-style}

Абзацы текста отделяется друг от друга переводами строки до и после.

Перевод текста на новую строку выполняется с помощью добавления двух пробелов  
в конце строки (здесь три слова "в конце строки" оказались вначале новой строки).

Полужирный шрифт может быть получен одним из способов: **полужирный** или __полужирный__.

Курсивный шрифт может быть получен одним из способов: *курсив* или _курсив_.

Полужирный курсив может быть получен одним из способов: ***полужирный курсив*** или ___полужирный курсив___.

После этого абзаца следует горизонтальная линия, заданная в виде трех последовательных знаков минус ("-"):

---

Моноширинный шрифт (обычно используется для отображения исходного кода) может быть задан с помощью двух символов машинописного обратного апострофа - `код в тексте`.

Многострочный исходный код отделяется от основного текста четырьмя пробелами:

    int main() {
    return 0;
    }

Цитаты или примечания оформляются с помощью знака больше (">"):

> Это цитата или примечание.

Поскольку настоящий документ компилируется в RStudio, поэтому здесь поддерживаются дополнительные возможности RMarkdown:

* верхний индекс, например для возведения в квадрат - x^2^ ;
* нижний индекс для индексации элементов - y~3~ ;
* зачеркнутых текст с помощью двойного знака тильды ("~") : ~~зачеркнутый текст~~ ;
* знак тире ("–") в виде двух последовательных знаков минус : понятие -- опеределение ;
* знак длинного тире ("—") в виде трех последовательных знаков минус : понятие --- понятие .

### Списки {#markdown-syntax-lists}

Ниже представлен нумерованный список из трех пунктов (нумерация выполняется автоматически)

1. Первый элемент списка;
1. Второй элемент списка;
1. Третий элемент списка.

> Примечание: автоматическая нумерация вложенных списков не поддерживается.

Ниже представлен ненумерованный список из трех элементов

* Верхний элемент списка;
* Средний элемент списка;
* Нижний элемент списка.

Списки могут быть вложенными, при этом уровни отделяются двумя пробелами:

* 1-й элемент уровня 1
* 2-й элемент уровня 1
    - 1-й элемент уровня 2
        + 1-й элемент уровня 3

Элементы списка могут содержать форматирование (полужирный шрифт, курсив, моноширинный шрифт и т.п.), могут содержать вложенные элементы. При этом код должен быть отделен необходимым дополнительным количеством пробелов:

* строка 1
* строка 2 с блоком кода

      int main(){
        return 0;
      }

  Далее следует цитата

  > Цитата

  и нумерованный список

  1. один
  1. два
  1. три

* строка 3

### Ссылки и сноски {#markdown-syntax-links}

Ниже представлена **ссылка** на сайт университета:

[Сайт НИУ "МЭИ"](http://www.mpei.ru)

В квадратных скобках указан текст ссылки, который будет отображаться на экране, а в круглых скобках указывается полный URL ресурса.

В этом абзаце имеется **сноска** [^1] с расшифровкой в конце страницы.

[^1]: Текст сноски

### Изображения {#markdown-syntax-media}

Простой Markdown не позволяет выполнять автоматическую нумерацию рисунков, но позволяет вставить **рисунок** c подписью. Далее следует рисунок с названием *Markdown*, сохраненный в файле **figures/Markdown-mark.png**:

![Markdown](figures/Markdown-mark.png)

Рисунок может не иметь названия, тогда код упрощается:

![](figures/Markdown-mark.png)

Автоматическая нумерация рисунков выполняется с помощью метки `fig`, поэтому рисунок с автоматической нумерацией и идентификатором `md-logo` может быть вставлен следующим образом:

![(\#fig:md-logo) Логотип Markdown](figures/Markdown-mark.png)

Ссылка на такой рисунок будет иметь вид: на рисунке \@ref(fig:md-logo) представлен логотип языка разметки Markdown.

Текст, обозначающий иллюстрацию (например, "Рис." или "Рисунок") задается в файле `_bookdown.yml` в YAML-секции `language`:

```
language:
  label:
    fig: 'Рис. '
```

Для каждого рисунка могут быть принудительно заданы его размеры с помощью соответствующих атрибутов `width` или `height` внутри фигурных скобок после описания изображения. Поддерживаются следующие единицы измерения `px`, `cm`, `mm`, `in` / `inch` и `%`. Для сохранения пропорций рекомендуется задавать один размер (ширину или высоту).

Пример задания ширины изображения:

![(\#fig:md-logo-w-1cm) Логотип Markdown шириной 1 см](figures/Markdown-mark.png){width=1cm}

Пример задания высоты изображения:

![(\#fig:md-logo-h-2cm) Логотип Markdown высотой 2 см](figures/Markdown-mark.png){height=2cm}

Пример задания ширины и высоты изображения:

![(\#fig:md-logo-w-64mm-h-39mm) Логотип Markdown шириной 64 мм и высотой 39 мм](figures/Markdown-mark.png){width=64mm, height=39mm}

### Таблицы {#markdown-syntax-tables}

Таблицы могут оформляться одним из способов - первый:

|    **Столбец 1**    |    **Столбец 2**    |
|---------------------|---------------------|
| строка 1, столбец 1 | строка 1, столбец 2 |
| строка 2, столбец 1 | строка 2, столбец 2 |

второй:

**Столбец 1**       | **Столбец 2**
--------------------|--------------------
строка 1, столбец 1 | строка 1, столбец 2
строка 2, столбец 1 | строка 2, столбец 2

Выравнивание столбцов выполняется с помощью знака двоеточия (":") во второй строке:

| **Столбец 1 (влево)**   | **Столбец 2 (по центру)** | **Столбец 3 (вправо)**  |
|:------------------------|:-------------------------:|------------------------:|
| строка 1, столбец 1     | строка 1, столбец 2       | строка 1, столбец 3     |
| строка 2, столбец 1     | строка 2, столбец 2       | строка 2, столбец 3     |

Автоматическая нумерация таблиц выполняется с помощью метки `tab` аналогично рисункам.

Для следования ГОСТ необходимо в строке с меткой добавить два пробела для перевода текста названия на следующую строку:

Table: (\#tab:uno-tech)  
Технические характеристики платы Arduino Uno R3

| **Параметр**                               | **Значение** |
|--------------------------------------------|--------------|
| Микроконтроллер                            |  ATmega328P  |
| Напряжение питания                         |   5 В        |
| Внешнее напряжение питания (рекомендуемое) |   7–12 В     |
| Внешнее напряжение питания (предельное)    |   6–20 В     |

> Примечание: английская надпись "Table:" обязательно должна присутствовать в начале строки для правильной нумерации таблицы.

Ссылка на таблицу выполняется аналогично рисунку: в таблице \@ref(tab:uno-tech) представлены технические характеристики платформы Arduino Uno.

Текст, обозначающий таблицу (например, "Табл." или "Таблица") задается в файле `_bookdown.yml` в YAML-секции `language`:

```
language:
  label:
    tab: 'Таблица '
```

Текст в таблицах может иметь форматирование.

В некоторых случаях требуется поместить несколько строк текста в одну ячейку таблицы. При этом используется другой способ задания таблиц, который показан ниже при оформлении таблицы \@ref(tab:soft-math-tab).

Table: (\#tab:soft-math-tab) Программы и языки программирования для математических расчетов

+----------------+-------------------------------------------------------------+-------------------------------------------------------------+
|                | **Визуальные**                                              | **Текстовые**                                               |
+===============:+:============================================================+:============================================================+
| **Платные**    | * [PTC MathCAD](http://www.ptc.com/product/mathcad)         | * [MathWorks MATLAB](http://www.mathworks.com) |
|                | * [Wolfram Mathematica](http://www.wolfram.com/mathematica) |                                                |
|                | * [Waterloo Maple](http://www.maplesoft.com)                |                                                |
|                |                                                             |                                                |
|                |                                                             |                                                |
|                |                                                             |                                                |
+----------------+-------------------------------------------------------------+-------------------------------------------------------------+
| **Бесплатные** | * [SMath Studio](http://smath.info)                         | * [Scilab](http://scilab.org/) |
|                | * [WolframAlpha](http://www.wolframalpha.com)               | * [GNU Octave](https://www.gnu.org/software/octave/) |
|                | * [wxMaxima](http://andrejv.github.io/wxmaxima)             | * [Sage](http://www.sagemath.org/) |
|                |                                                             | * [FreeMAT](http://freemat.sourceforge.net/) |
|                |                                                             | * [Axiom](http://axiom-developer.org) |
|                |                                                             | * [Reduce](https://reduce-algebra.sourceforge.io) |
|                |                                                             | * [Euler Math Toolbox](http://euler.rene-grothmann.de/index.html) |
|                |                                                             | * [Julia](http://julialang.org/) |
|                |                                                             | * [Spyder - The Scientific PYthon Development EnviRonment](https://code.google.com/p/spyderlib/) |
|                |                                                             | * [R](https://cran.rstudio.com/), [RStudio](https://rstudio.com/products/rstudio/) |
|                |                                                             | * написание программ на языках [Fortran](http://en.wikipedia.org/wiki/Fortran), |
|                |                                                             | [C](http://en.wikipedia.org/wiki/C_(programming_language))/[C++](http://en.wikipedia.org/wiki/C++) с |
|                |                                                             | библиотеками [LAPACK](http://www.netlib.org/lapack/), [BLAS](http://www.netlib.org/blas/), |
|                |                                                             | [ATLAS](http://math-atlas.sourceforge.net/), |
|                |                                                             | [MINPACK](http://www.netlib.org/minpack/), [NETLIB.org](http://netlib.org/), |
|                |                                                             | [Armadillo](http://arma.sourceforge.net/) |
+----------------+-------------------------------------------------------------+-------------------------------------------------------------+
                                                                                     
> Примечание: еще большее количество типов таблиц можно найти внутри документа [проекта GostDown](https://gitlab.iaaras.ru/iaaras/gostdown/blob/master/demo-main.md) или в [соответствующем разделе документации по Pandoc](https://pandoc.org/MANUAL.html#tables).

### Формулы {#markdown-syntax-math}

Формулы без нумерации и расположенные непосредственно могут быть набраны в одиночных знаках доллара, например, $a^2 + b^2 = c^2$.

Формулы без нумерации и расположенные в отдельной строке могут быть набраны в двойных знаках доллара в отдельной строке, как показано ниже

$$ E = \frac{mc^2}{\sqrt{1-\frac{v^2}{c^2}}} $$

или

$$
E = \frac{mc^2}{\sqrt{1-\frac{v^2}{c^2}}}
$$

Формулы с автоматической нумерацией отличаются наличием идентификатора в круглых скобках `(\#eq:name)`:

\begin{equation}
f\left(k\right) =\binom{n}{k} p^k\left(1-p\right)^{n k}
(\#eq:binom)
\end{equation}

При необходимости формула и ее номер могут быть правильно выравнены в MS Word с помощью применения пользовательского стиля *DisplayEquation*:

::: {custom-style="DisplayEquation"}
\begin{equation}
S_{AM}\left( t \right) = U\left( 1+M\cdot F\left( t \right) \right)\cos \left( \omega_c\cdot t \right)
(\#eq:am)
\end{equation}
:::

Ссылка на формулу выполняется с помощью поля `\@ref(eq:name)`: ссылаемся на первое выражение - \@ref(eq:binom) и второе выражение \@ref(eq:am).

Набор формул возможен в MathType 6 (желательно 6.9 и выше) с последующим экспортом в LaTeX с помощью меню *Preferences* - *Cut and Copy Preferences* : в списке *MathML or TeX* нужно выбрать пункт *Plain TeX*.

Для быстроты копирования можно снять обе галочки: *Include translator name in translation* и *Include MathType data in translation*.  
Но иногда при экспорте в docx возникают ошибки pandoc вида `[pandoc warning] Cannot convert the following TeX math, skipping:`, поэтому лучше использовать LyX для набора или исправления формул.

#### Формулы с матрицами {#markdown-syntax-math-matrix}

Матрицы:

$$AA = \begin{pmatrix} \alpha_{22} & \beta\\
 \Xi^2 & 1
\end{pmatrix}$$

$$\begin{pmatrix} 1 & 2 \\ 3 & 4 \end{pmatrix},
\begin{bmatrix} 1 & 2 \\ 3 & 4 \end{bmatrix},
\begin{vmatrix} 1 & 2 \\ 3 & 4 \end{vmatrix},
\begin{Vmatrix} 1 & 2 \\ 3 & 4 \end{Vmatrix}$$

Матрица с точками:

$$A = \begin{pmatrix}
a_{11} & a_{12} & \cdots & a_{1n} \\
a_{21} & a_{22} & \cdots & a_{2n} \\
\vdots & \vdots & \ddots & \vdots \\
a_{n1} & a_{n2} & \cdots & a_{nn}
\end{pmatrix}$$

Система уравнений со скобкой:

\begin{equation*}
 \begin{cases}
   2 |x|(2 - x) = a, \\
   x < 2, \\
   x \ne 0.
 \end{cases}
\end{equation*}

#### Формулы с интегралами и дифференциалами {#markdown-syntax-math-syms}

В этом разделе собраны символы, наиболее часто используемые в дифференциальном и интегральном исчислении:

* `lim` предел;
* `prod` произведение;
* `sum` сумма;
* `frac` черта деления;
* `int` интеграл;
* `iint` двойной интеграл;
* `iiint` тройной интеграл;
* `oint` круговой интеграл;
* `partial` частная производная;
* `infty` бесконечность;
* `to` стрелка (в пределах);
* `pm` плюс-минус

Дроби, в которых числитель расположен над знаменателем, набираются с помощью команды $\frac{числитель}{знаменатель}$.

Производная в виде дроби:

\begin{equation}
F(x) = 2+\frac{d}{dx}(U(x))
\end{equation}

Частная производная:

\begin{equation}
dz = \frac{\partial z}{\partial x} dx + \frac{\partial z}{\partial y} dy
\end{equation}

Интегралы:

\begin{equation}
\int_{0}^{3} f(x) dx
\end{equation}

\begin{equation}
\iint_{x^2 + y^2 = 1} f(x, y) dx dy
\end{equation}

\begin{equation}
\iiint_{x^2 + y^2 + z^2 = 1} f(x, y, z) dx dy dz
\end{equation}

Пределы:

\begin{equation}
\lim\limits_{x \to \infty} \left(1 + \frac{1}{n} \right)^n = e
\end{equation}

Произведение:

\begin{equation}
F(x)= \prod_{n=1}^{\infty}\left(1 + \frac{x}{n!} \right)
\end{equation}

Функции:

\begin{equation}
    \lim_{n \to \infty}
    \sum_{k=1}^n \frac{1}{k^2}
    = \frac{\pi^2}{6}
\end{equation}

\begin{equation}
\arg, \cos, \cosh, \cot, \coth, \csc,\det, \dim, \exp, \gcd, \hom, \inf, \ker, \lg, \ln
\end{equation}

\begin{equation}
\log, \max, \min, \sec, \sin, \sinh, \sup,\tan, \tanh, \arccos, \arcsin, \arctan
\end{equation}

\begin{equation}
    \begin{matrix}
    \hat{\Phi}[k,l] & =
    & \left\{
    \begin{matrix}
    0 & \mbox{if } k,l = 0 \\
    S_x[k,l]\cdot H_x[k,l] + S_y[k,l]\cdot H_y[k,l] & \mbox{otherwise }
    \end{matrix} \right.
    \end{matrix}
\end{equation}

\begin{equation}
S_{\text{вых}}(x_2, y_2) = A_0 \underbrace{\iint dx_0 dy_0 \; g(x_0, y_0) \cdot h(x_2-x_0, y_2 -y_0)}_{\text{по определению это есть свёртка }} = A_0 g \otimes h
\end{equation}

#### Примеры формул {#markdown-syntax-math-examples}

Амплитудная модуляция:

\begin{equation}
S_{AM}(t)=U(1+M \cdot F(t)) \cos{(\omega t+\phi)}
\end{equation}

Амплитудная однотональная модуляция:

\begin{equation}
S_{AM}(t)=U(1+M \cdot \cos{(\Omega t)}) \cos{(\omega_{c} t+\phi)}
\end{equation}

Амплитудная однотональная модуляция, разложение:

\begin{eqnarray}
S_{AM}(t)=U(1+M \cdot \cos{(\Omega t)}) \cos{( \omega_{c} t)} = \nonumber
\\
 = U \cos{(\omega t)} +U \cdot M \cdot \cos{(\Omega t)}) \cos{(\omega_{c} t)} =\nonumber
\\
 = U \cos{(\omega_{c} t)} +\frac{U \cdot M}{2} \cos{((\omega_{c}-\Omega) t)}) + \frac{U \cdot M}{2} \cos{((\omega_{c}+\Omega) t)})
\end{eqnarray}

\begin{eqnarray}
S_{AM}(t)= \underbrace{U \cos{(\omega_{c} t)}}_{\text{несущая}} +\nonumber
\\
+ \underbrace{\frac{U \cdot M}{2} \cos{((\omega_{c}-\Omega) t)})}_{\text{нижняя боковая полоса}} +\nonumber
\\
+\underbrace{\frac{U \cdot M}{2} \cos{((\omega_{c}-\Omega) t)})}_{\text{верхняя боковая полоса}} \nonumber
\end{eqnarray}

Частотная модуляция:

\begin{equation}
S_{FM}(t)=U \cos{((\omega_{c}+D \cdot F(t)) t+\phi)}
\end{equation}

Фазовая модуляция:

\begin{equation}
S_{PM}(t)=U \cos{(\omega_{c} t+(\phi+D \cdot F(t)))}
\end{equation}

Коэффициент передачи ФНЧ:

\begin{equation}
K(\omega)= \frac {1}{1+j\omega \tau}
\end{equation}

Коэффициент передачи ФВЧ:

\begin{equation}
K(\omega)= \frac {j\omega \tau}{1+j\omega \tau}
\end{equation}

Последовательный колебательный контур:

\begin{equation}
K(\omega)= \frac{U_{C}}{E}= \frac { \frac{1}{j\omega C}}{j \omega L+ \frac{1}{j\omega C}+R}
\end{equation}

\begin{equation}
K(\omega)=  \frac {1}{1 -\omega^2 LC+j \omega RC}
\end{equation}

Формула с прямым русским (кириллическим) текстом:

\begin{equation}
U_\text{вых.} = U_\text{м} \cos(\omega t)
\end{equation}

Формула с курсивным русским (кириллическим) текстом:

\begin{equation}
U_\textit{вых.} = U_\textit{м} \cos(\omega t)
\end{equation}


### Список литературы и библиографические ссылки {#markdown-syntax-bib}

Список литературы задается в виде отдельного файла с записями в формате BibTeX (*.bib*). Пример фрагмента файла *bibliography.bib*:

```
@online{arduino,
  title = {Arduino – Home},
  url = {https://www.arduino.cc/},
}

@book{banzi,
  title = {Arduino для начинающих волшебников},
  publisher = {М.: Рид Групп},
  author = {{Массимо Банци}},
  year = {2012},
}
```

Описание библиографической записи в формате BibTeX для книг может быть получено с сайта [Google Books](https://books.google.ru/) - нужно найти книгу с помощью поиска, найти ссылку *About this book* и перейти по ней, далее на открывшейся странице с описанием книги найти в области *Export Citation* кнопку *BiBTeX* и скопировать описание книги в bib-файл.

Каждый элемент bib-файла характеризуется типом (в этом примере это `@online` для веб-страницы и `@book` для книги) и идентификатором, следующим после открывающей фигурной скобки (в этом примере `arduino` и `banzi`).

Ссылка в тексте дается в квадратных скобках с указанием идентификатора объекта после символа @.

Пример ссылки в тексте: для изучения платформы Arduino см. веб-страницу проекта Arduino [@arduino] и книгу М. Банци [@banzi].

При необходимости можно добавить ссылку с учетом номеров страниц: см. книгу М. Банци [@banzi, с. 11] или [@banzi, с. 15-20].

Оформление списков литературы выполняется в соответствии с правилами, заданными в CSL-файле стиля ссылок в YAML-преамбуле. К этому документу подключен файл *gost-r-7-0-5-2008-numeric.csl*, соответствующий ГОСТ Р 7.0.5-2008 с цифровой нумерацией источников в порядке их упоминания в тексте.

### Листинги исходного кода {#markdown-listings}

В некоторых случаях оказывается необходимым выполнять нумерацию фрагментов исходного кода (листингов). Для этого в файле `_bookdown.yml` в секции *language* можно переобозначить индекс, предназначенный для оформления примеров:

```
language:
  label:
    exm: 'Листинг '
```

В этом случае фрагмент программы может быть оформлен с использованием пользовательского стиля *ListingCaption* для docx следующим образом:

::: {custom-style="ListingCaption"}
```{example, code-blink}
Программа для отображения работы программы с помощью светодиода
```
:::
```
// зададим номер контакта, к которому подключен светодиод
int ledPin = 13;

// функция setup выполняется однократно при нажатии клавиши сброса или включении платы
void setup() {
  // инициализация контакта, к которому подключен светодиод как выходного (OUTPUT)
  pinMode(ledPin, OUTPUT);
}

// функция loop выполняется в бесконечном цикле
void loop() {
  digitalWrite(ledPin, HIGH);   // включаем светодиод (HIGH – это напряжение 5 В)
  delay(1000);                       // пауза 1000 мс
  digitalWrite(ledPin, LOW);    // выключаем светодиод (в этом случае LOW – это напряжение 0 В)
  delay(1000);                       // пауза 1000 мс
}
```

Ссылка на листинг исходного кода оформляется в виде: см. листинг \@ref(exm:code-blink).

### Оглавление {#markdown-toc}

Оглавление или содержание задается в YAML-преамбуле документа и имеет вид:

```
---
toc-title: "Оглавление"
output:
  bookdown::word_document2:
    toc: true
    toc_depth: 5
  bookdown::html_document2:
    toc: true
    toc_depth: 5
---
```

здесь `toc-title` задает текст, выводимый перед оглавлением, `toc: true` включает отображение оглавления, `toc_depth` задает количество отображаемых уровней заголовков в оглавлении.

### Вычисления RMarkdown {#markdown-rmarkdown}

RMarkdown позволяет объединять в одном документе расчеты и оформление результатов. Ниже представлен код для создания вложенного нумерованного списка:

`r p<-1; p`. Пункт  
`r p`.`r sp<-1; sp`. Подпункт  
`r p`.`r sp <- sp + 1; sp`. Подпункт  
`r p<-p+1; p`. Пункт

## Необходимое программное обеспечение {#software}

Для локальной работы необходимо установить следующие компоненты: язык программировани R, среду RStudio, и набор типографских программ TeXLive для подготовки LaTeX- и PDF-версий документа и редактор ReText для редактирования документов Markdown.

Для редактирования полученного docx-файла необходим Microsoft Office 2007 (с SP3 и со всеми обновлениями) или более новой версии.

Для работы с формулами внутри docx-файла необходим MathType 6.9b.

### R, RStudio, TeXLive {#software-r}

#### Установка под Windows {#software-r-windows}

Поддерживается 64-битная версия Windows 7 и выше.

1. Скачать R 3.4.4 for Windows с [официального сайта](https://cran.r-project.org/bin/windows/base/old/3.4.4/R-3.4.4-win.exe) и установить со всеми настройками по умолчанию.

1. Скачать редактор Notepad++ с [официального сайта](https://notepad-plus-plus.org/download/) и установить со всеми настройками по умолчанию.

1. Для сборки демонстрационного примера потребуется скачать Git for Windows с [официального сайта](https://git-scm.com/download/win) и установить, выбрав на этапе *Choosing the default editor used by Git* пункт *Use Notepad++ as Git's default editor*.

1. Скачать RStudio с [официального сайта](https://www.rstudio.com/products/rstudio/download/preview/) и запустить установку файла `RStudio-....exe` и дождаться ее завершения.

1. Для сборки PDF-версии документа с помощью RStudio потребуется установить TeX-пакеты от проекта TeXLive.

    > **Примечание:** в сети попадаются инструкции по использованию под Windows дистрибутива [MikTeX 2.9](https://miktex.org/howto/install-miktex), но он не работает совместно с RStudio. Например, не находит шрифт CMU Sans Serif.
    > В Ubuntu применяется TeXLive, поэтому будем использовать именно его и под Windows.

    Установка TeXLive содержит следующие шаги:

    1. Скачать дистрибутив TeXLive с [официального сайта](http://ctan.altspu.ru/systems/texlive/tlnet/install-tl-windows.exe).
    1. Запустить установщик, выбрать режим *Custom install*, нажать *Next* и *Install*.
    1. В открывшемся окне нажать кнопку *Continue*.
    1. В большом окне в области *Installation collections* нажать кнопку *Change*
    1. В открывшемся окне *Installation collections* снять галочки *Arabic*, *Chinese*, *Chinese/Japanese/Korean (base)*, *Czech/Slovak*, *Other European languages*, *French*, *German*, *Greek*, *Italian*, *Japanese*, *Korean*, *Other languages*, *Polish*, *Portuguese*, *Spanish* и нажать кнопку *Install TeX Live* (такая установка потребует 4173 Мб).
    1. Начнется скачивание файлов для установки и далее их установка.
    1. По окончанию установки нажать кнопку *Finish* и затем в малом окне *TeX Live Installer: unpacking ...* нажать *Close*.

1. Запустить RStudio и установить пакеты R для поддержки [bookdown](https://bookdown.org/home/getting-started.html) через командную строку внутри RStudio, выполнив последовательно команды в окне *Console*:

       install.packages("devtools")

    > **Примечание:** при появлении запроса `Do you want to install from sources the package which needs compilation?
y/n` на установку компилируемых пакетов следует ответить `n` (отказаться).

       devtools::install_github("rstudio/bookdown")

    и закрыть RStudio.

1. Для подготовки первого RMarkdown документа следует клонировать [демонстрационный репозиторий](https://github.com/rstudio/bookdown-demo) с помощью Git - открыть Проводник, нажать правую кнопку мыши, выбрать в выпадающем меню пункт *Git Bash Here*, вставить в командную строку команду `git clone https://github.com/rstudio/bookdown-demo.git`, нажать Enter и дождаться завершения клонирования, закрыть окно *MINGW...*.

1. Перейти в только что созданный каталог `bookdown-demo` и выполнить двойной щелчок мышью по файлу `bookdown-demo.Rproj` для открытия проекта книги в RStudio.

1. Дождаться открытия RStudio, выбрать в верхней правой части окна вкладку *Build* и нажать стрелку вниз рядом с пунктом *Build Book* и выбрать пункт *bookdown:gitbook* для подготовки HTML-версии книги.

    > **Примечание:** возможно появление окна *Install Required Packages*,
    > в котором нужно нажать кнопку *Yes* для обновления пакетов.

    По завершению сборки откроется HTML-версия книги.

    > **Примечание:** если требуется подготовка книги в EPUB-формате (*bookdown:epub_book*), то для просмотра этого формата
    > нужно установить дополнительный просмотрщик. Например, простой и легковесный [Sumatra PDF](https://kjkpub.nyc3.digitaloceanspaces.com/software/sumatrapdf/rel/SumatraPDF-3.1.2-install.exe).

1. Для сборки PDF-версии документа следует выбрать в верхней правой части окна RStudio вкладку *Build* и нажать стрелку вниз рядом с пунктом *Build Book* и выбрать пункт *bookdown:pdf_book*.

#### Установка под Ubuntu {#software-r-ubuntu}

Будем считать, что используется 64-битная версия Ubuntu 16.04 LTS.

1. Для получения наиболее свежей версии R следует подключить официальный репозиторий проекта с помощью следующих команд в терминале:

       cat <<EOF | sudo tee /etc/apt/sources.list.d/r-cran.list
       deb https://cloud.r-project.org/bin/linux/ubuntu xenial/
       EOF
       sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9

       sudo apt-get update
       
       sudo apt-get install r-base-dev libssl-dev libjpeg62 libgstreamer0.10-0 libgstreamer-plugins-base0.10-0 calibre

1. Установить компоненты TeXLive с помощью команд

       sudo apt-get install biber texlive-lang-cyrillic fonts-cmu texlive-xetex texlive-fonts-extra texlive-math-extra font-manager ttf-mscorefonts-installer lmodern

1. Установить следующие зависимости для сборки специализированных пакетов для R:

       sudo apt-get install build-essential libcurl4-openssl-dev libxml2-dev libcairo2-dev git

1. Скачать актуальную версию конвертера Pandoc с [официального сайта](https://github.com/jgm/pandoc/releases) в виде deb-пакета и установить с помощью команды:

       sudo apt-get install ./pandoc-*-amd64.deb

1. Скачать RStudio с [официального сайта](https://www.rstudio.com/products/rstudio/download/preview/) и установить пакет *rstudio-...-amd64.deb* с помощью графической программы GDebi.

1. Запустить RStudio и установить пакеты R для поддержки [bookdown](https://bookdown.org/home/getting-started.html) через командную строку внутри RStudio, выполнив последовательно команды в окне *Console*:

       install.packages("devtools")
       devtools::install_github("rstudio/bookdown")

    и закрыть RStudio.

1. Для подготовки первого RMarkdown документа следует клонировать [демонстрационный репозиторий](https://github.com/rstudio/bookdown-demo) с помощью Git - выполнить в терминале в удобном каталоге команду

       git clone https://github.com/rstudio/bookdown-demo.git

1. Перейти в только что созданный каталог `bookdown-demo` и выполнить двойной щелчок мышью по файлу `bookdown-demo.Rproj` для открытия проекта книги в RStudio.

1. Дождаться открытия RStudio, выбрать в верхней правой части окна вкладку *Build* и нажать стрелку вниз рядом с пунктом *Build Book* и выбрать пункт *All Formats* для подготовки всех форматов книги (или нажать `Ctrl+Shift+B`).

### Текстовый редактор ReText {#software-retext}

Редактирование отдельных Markdown файлов можно выполнять в простом визуальном редакторе [ReText](https://github.com/retext-project/retext).

Для Windows нужно установить [Python 3.7.x](https://www.python.org/getit/windows/) (поставив галочку *Add Python 3.x to PATH*) и затем установить ReText из репозитория pip с помощью команды `pip install ReText PyQt5==5.9.2`. После установки редактор можно запустить командой `retext` и создать затем ярлык для программы.

> **Примечание:** в случае если при открытии документа с русским текстом символы в редакторе отображаются некорректно, следуют изменить шрифты на поддерживающие кириллицу.  
> Для этого следует нажать в меню **Edit** на пункт **Change editor font** для смены шрифта в редакторе и выбрать нужный шрифт (обычно моноширинный, например *Courier New*).  
> Далее следует повторить действия для шрифта предварительного просмотра **Change preview font** и выбрать нужный шрифт (обычно не моноширинный, например *Times New Roman*).

Для Ubuntu редактор содержится в репозитории под именем пакета `retext`. Более новая версия доступна через pip - установка с помощью `sudo -H pip3 install ReText PyQt5==5.9.2`. Для поддержки проверки орфографии нужно установить специальный пакет командой `sudo apt-get install python3-enchant`.

Следует учитывать, что редактор ReText не поддерживает расширения RMarkdown. Однако, это не мешает их использованию и набору в тексте.

Для поддержки формул внутри текста (вида `$...$`) нужно включить в настройках расширение `mathjax` (в линуксе с помощью команды `echo mathjax > $HOME/.config/markdown-extensions.txt`) и переключить режим предварительного просмотра на использование движка *WebEngine (Chromium) Renderer*.

Для игнорирования YAML заголовка нужно добавить в строку дополнений `meta`.

## Процесс подготовки odt-документов {#authoring-odt}

Для odt-документов требуются дополнительные действия.

### Использование odt-шаблона {#authoring-odt-template}

Для удовлетворения требований оформления под конкретный случай возможно создание и использование файла odt-шаблона. В этом файле задается формат страницы, поля страницы, стили заголовков и текста. Путь в файлу odt-шаблона задается в YAML-преамбуле:

```
---
output:
  bookdown::odt_document2:
    reference_docx: styles-reference.odt
---
```

Файл шаблона может быть многократно последовательно изменен до получения качественного результата.

Особенности:

1. На текущий момент не поддерживаются пользьзовательские стили оформления участков текста.
1. Формулы будут отображаться в формате OMML, их преобразование в MathType под GNU/Linux невозможно.

### Финальная подготовка рукописи {#authoring-odt-final}

Финальная подготовка текста включает следующие этапы:

* оформление **страниц** и их порядок следования:

  1. Редактирование титульного листа в соответствии с требованиями.
  1. Перенос страницы задания и/или аннотации на второй лист (после титульного листа) перед оглавлением.
  1. Удаление нумерации перед следующими структурными элементами: *Аннотация*, *Введение*, *Заключение*, *Приложения*, *Список использованных источников* (нужно нажать мышью на номер и выполнить удаление кнопкой `<Delete>`).
  1. Ручной перенос приложений в конец документа (после списка использованных источников).
  1. Ручное добавление заголовков "Продолжение Приложения #" в случае если приложения состоят двух и более страниц.

* оформление **таблиц**:

  1. Перенос названий и номеров таблиц снизу таблицы наверх.
  1. Ручное добавление текста "Продолжение табл. #" в случае если таблица не помещается на одну страницу.

* оформление **формул**:

  1. Выравнивание формулы и ее номера вручную с помощью соответствующего стиля.

* действия **перед печатью**:

  1. Проверка правописания с корректировкой ошибок.
  1. Обновление всех ссылок документа с помощью последовательного нажатия комбинаций клавиш `<Ctrl+A>`, `<F9>` или из меню *Tools → Update → Update All*.

## Процесс подготовки docx-документов {#authoring-docx}

Аналогично формату odt, для docx-документов требуются дополнительные действия.

### Использование docx-шаблона {#authoring-docx-template}

Для удовлетворения требований оформления под конкретный случай возможно создание и использование файла docx-шаблона. В этом файле задается формат страницы, поля страницы, стили заголовков и текста. Путь в файлу docx-шаблона задается в YAML-преамбуле:

```
---
output:
  bookdown::word_document2:
    reference_docx: styles-reference.docx
---
```

Файл шаблона может быть многократно последовательно изменен до получения качественного результата.

### Преобразование формул {#authoring-docx-math}

RStudio использует Pandoc для преобразования документов из Markdown в другие форматы. Поэтому формулы оказываются преобразованными в формат OMML (Microsoft's Office Math Markup Language) вместо MathType. Но для издательства МЭИ и при оформлении дипломов и отчетов достаточно строго требуется использование MathType, поэтому необходимо выполнить конвертацию формул из OMML в MathType:

1. Открыть docx-документ в Word (иногда *Открыть и восстановить*);
1. На ленте *MathType* нажать кнопку *Convert Equations*;
  в открывшемся окне установить в области *Equation types to convert* галочку *Word 2007 and late (OMML) equations*, затем в области *Convert equations to* выбрать *MathType equations (OLE objects)*.
1. Нажать кнопку *Convert* и ждать результата.
1. Отформатировать все формулы (греческие буквы - прямо и т.п.) - нажать на ленте *MathType* кнопку *Format Equations*, в области *Format equations using preferences from* установить переключатель в положение *MathType preference file*, нажать кнопку *Browse*, выбрать файл настроек `format.eqp` и применить изменения кнопкой *OK*.

**Примечание:** При конвертации из OMML в MathType могут не работать LaTeX-окружения `split` и `multiline`, поэтому надежнее использовать `array`.

### Финальная подготовка рукописи {#authoring-docx-final}

Финальная подготовка текста включает следующие этапы:

* оформление **страниц** и их порядок следования:

  1. Выделение первой страницы под титульный лист и ее добавление в начало документа.
  1. Перенос страницы задания и/или аннотации на второй лист (после титульного листа) перед оглавлением.
  1. Удаление нумерации перед следующими структурными элементами: *Аннотация*, *Введение*, *Заключение*, *Приложения*, *Список использованных источников* (нужно нажать мышью на номер и выполнить удаление кнопкой `<Delete>`).
  1. Ручной перенос приложений в конец документа (после списка использованных источников).
  1. Ручное добавление заголовков "Продолжение Приложения #" в случае если приложения состоят двух и более страниц.

* оформление **таблиц**:

  1. Ручное добавление текста "Продолжение табл. #" в случае если таблица не помещается на одну страницу.

* оформление **формул**:

  1. Преобразование всех формул из OMML в MathType (см. раздел \@ref(authoring-docx-math) выше).

* действия **перед печатью**:

  1. Проверка правописания с корректировкой ошибок.
  1. Обновление всех ссылок документа с помощью последовательного нажатия комбинаций клавиш `<Ctrl+A>`, `<F9>` и выбора пункта *Обновить целиком* в диалоговом окне.
  1. Проверка отсутствия неработоспособных ссылок с помощью поиска (`<Ctrl+F>`, текст *Ошибка!*).

